<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
	<h:head>
		<h:outputStylesheet library="css" name="estilos.css"/>
		<meta charset="UTF-8" />
		<title>Meu financeiro</title>
	</h:head>
	<h:body>

		<h1>Financeiro</h1>
	
		<br/>
		<br/>
		
		<div id="menu" class="form-container">
			<h:form>
				<h:outputLabel value="Mês selecionado: " for="selectMes" />
				<h:selectOneMenu id="selectMes" value="#{indexBean.mesSelecionado}">
					<f:selectItems value="#{indexBean.meses}" var="mes" itemLabel="#{mes}" itemValue="#{mes}"/>
					<f:ajax event="change" render="tabelaDividas valorTotalDivida" listener="#{indexBean.eventoDeSelecaoDoMes}" />
				</h:selectOneMenu>
			</h:form>
			
			<div id="totalDividas">
				<h:form id="valorTotalDivida">
					<h:panelGrid columns="2">
						<h:outputText value="Valor total: " />
						<h:outputText value="#{indexBean.somatorioTotalDeDividas}" />
					</h:panelGrid>
				</h:form>
			</div>
			
			<h:form>
				<h:commandButton styleClass="h-commandButton" 
					value="Fechamento mensal" 
					action="#{indexBean.telaDeFechamentoMensal}"
					style="background-color: green;"/>
			</h:form>
		</div>
		
		<br/>
		<br/>
		
		<div class="table">
			<h:dataTable id="tabelaDividas" styleClass="centralized-table" value="#{indexBean.dividas}" var="divida">
				<h:column rendered="#{!indexBean.existeCalculo}">
					<f:facet name="header">
						<h:form>
							<h:commandButton id="novaDivida" 
								value="Nova divida" 
								title="Nova divida" 
								image="https://ik.imagekit.io/macgarcia/app-web-contas/logo_novo_verde.png?updatedAt=1695695018493" 
								action="#{indexBean.telaDeCadastro}"
								immediate="true"
								styleClass="h-commandButton icone" />
						</h:form>
					</f:facet>
					<h:form>
					    <h:commandButton id="editarDivida" 
					    	value="Editar"
					    	title="Editar divida"
					    	image="https://ik.imagekit.io/macgarcia/app-web-contas/logo_editar_azul.png?updatedAt=1695695127464"
					    	action="#{indexBean.editarDivida(divida)}"
					    	immediate="true"
					    	styleClass="h-commandButton icone" />
								
					    <h:commandButton id="excluirDivida" 
					    	value="Excluir Item"
					    	title="Excluit divida"
					    	image="https://ik.imagekit.io/macgarcia/app-web-contas/logo_excluir_vermelho.png?updatedAt=1695697451253" 
					    	action="#{indexBean.excluirDivida(divida)}"
					    	styleClass="h-commandButton icone"
					    	onclick="return confirm('Tem certeza de que deseja excluir este item?');"
					    	immediate="true"
					    	render="tabelaDividas" />
					</h:form>
				</h:column>
				<h:column>
					<f:facet name="header" >
						<h:outputText value="Descrição"/>
					</f:facet>
					<h:outputText value="#{divida.descricao}"/>
				</h:column>
				<h:column>
					<f:facet name="header" >
						<h:outputText value="Valor R$"/>
					</f:facet>
					<h:outputText value="#{divida.valorFormatado}"/>
				</h:column>
				<h:column>
					<f:facet name="header" >
						<h:outputText value="Data"/>
					</f:facet>
					<h:outputText value="#{divida.dataFormatada}"/>
				</h:column>
				<h:column>
					<f:facet name="header" >
						<h:outputText value="Mês referencia"/>
					</f:facet>
					<h:outputText value="#{divida.mes}"/>
				</h:column>
				<h:column>
					<f:facet name="header" >
						<h:outputText value="Categoria"/>
					</f:facet>
					<h:outputText value="#{divida.categoria}"/>
				</h:column>
				<h:column>
					<f:facet name="header" >
						<h:outputText value="Ano"/>
					</f:facet>
					<h:outputText value="#{divida.ano}"/>
				</h:column>
				<h:column>
				    <f:facet name="header">
				        <h:outputText value="Fechamento mensal" />
				    </f:facet>
				    <h:graphicImage class="icone"
				    	url="#{divida.calculoMensal != null ? 
				    	'https://ik.imagekit.io/macgarcia/app-web-contas/logo_ok_verde.png?updatedAt=1695695894108' 
				    	: 'https://ik.imagekit.io/macgarcia/app-web-contas/logo_nao_vermelho.png?updatedAt=1695697461792'}"/>
				</h:column>
			</h:dataTable>
			<br/>
		</div>
	</h:body>
</html>